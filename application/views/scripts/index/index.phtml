<?php
$this->title = "Accomodations";
$this->headTitle($this->title);
?>
	<p>
		<a
			href="<?php echo $this->url(array('controller'=>'index', 'action'=>'add'));?>">Add
			new accomodation</a>
	</p>
	
 <?php if ($this->listings == null) { ?>
	<p>There are no accomodations to show.</p>
 <?php } else {?>
<table>
	<tr>
		<th>Type</th>
		<th>Street</th>
		<th>City</th>
		<th>State</th>
		<th>Bedrooms</th>
		<th>Max Guests</th>
		<th>Amenities</th>
		<th>&nbsp;</th>
	</tr>

  <?php foreach($this->listings as $listing) : ?>
		<tr>
			<td><?php echo $this->escape($listing->type);?></td>
			<td><?php echo $this->escape($listing->address['street_name']);?></td>
			<td><?php echo $this->escape($listing->address['city']);?></td>
			<td><?php echo $this->escape($listing->address['state']);?></td>
			<td><?php echo $this->escape($listing->bedrooms);?></td>
			<td><?php echo $this->escape($listing->guests);?></td>

        <?php $eoptions = $listing->amenities;?>
        	<td><?php if ($eoptions != null) { foreach ($eoptions as $k => $v) { echo "$k -&gt; \"$v\" <br/>"; } }?></td>
        	<td> 
            	<a href="<?php echo $this->url(array('controller'=>'index', 'action'=>'edit', 'id'=>$listing->id));?>">Edit</a>
            	<a href="<?php echo $this->url(array('controller'=>'index', 'action'=>'delete', 'id'=>$listing->id));?>">Delete</a>
        	</td>
		</tr>
  <?php endforeach; ?>
  
	<script type="text/javascript">
		var villaLatLngs = new Array();
		<?php 
			$iCtr = 0;
			$cLat;
			$cLng;
		?>
	
		<?php 	foreach($this->listings as $listing) : ?>
			villaLatLngs[<?php echo $iCtr++ ?>] = new Array(
				"<?php echo $this->escape($listing->address['street_name']);?>",
				"<?php echo $this->escape($listing->address['coordinates']['latitude']);?>", 
				"<?php echo $this->escape($listing->address['coordinates']['longitude']);?>",
				"<?php echo $this->escape($listing->address['city']);?>");
				<?php if( $this->escape($listing->address['coordinates']['latitude']) > 0 )
					$cLat = $this->escape($listing->address['coordinates']['latitude']);
					$cLng = $this->escape($listing->address['coordinates']['longitude']);
				?>
		<?php	endforeach;	?>
		
		var myMapOptions = {
			zoom: 12,
			center: latlng,
			scale: 2,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		}
	</script>
	  
	<script type="text/javascript" src="/js/jquery-min-164.js"> </script>
	<script type="text/javascript" src="/js/mapMarker.js"> </script>
	<script type="text/javascript"
		src="http://maps.googleapis.com/maps/api/js?sensor=false">
	</script>

	<script type="text/javascript">
		$(document).ready(function(){
			mapMarker( villaLatLngs, <?php echo $cLat ?>, <?php echo $cLng ?>, "zvMapInfo");
		});
	</script>
  		
 </table>
<?php }?>
